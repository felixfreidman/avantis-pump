"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var fancySwiper=new Swiper("#processSwiper",{direction:"horizontal",loop:!0,speed:500,spaceBetween:34,effect:"fade",fadeEffect:{crossFade:!0},slidesPerView:"1",pagination:{el:".process-parent__navigation",clickable:!0}}),cafeSwiper=new Swiper("#resultSeiper",{direction:"horizontal",loop:!1,speed:400,effect:"cards",slidesPerView:"1",navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}}),faqBlocks=document.querySelectorAll(".faq-parent__block");faqBlocks.forEach(function(e){e.addEventListener("click",function(){e.classList.contains("faq-parent__block--active")?e.classList.remove("faq-parent__block--active"):e.classList.add("faq-parent__block--active")})}),AOS.init();var preload=function(){var e=new THREE.LoadingManager;e.onLoad=function(){new Environment(t,i)};var t=null,i=(new THREE.FontLoader(e).load("https://res.cloudinary.com/dydre7amr/raw/upload/v1612950355/font_zsd4dr.json",function(e){t=e}),new THREE.TextureLoader(e).load("https://res.cloudinary.com/dfvtkoboz/image/upload/v1605013866/particle_a64uzf.png"))};"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?preload():document.addEventListener("DOMContentLoaded",preload);var Environment=function(){function i(e,t){_classCallCheck(this,i),this.font=e,this.particle=t,this.container=document.querySelector("#magic"),this.scene=new THREE.Scene,this.createCamera(),this.createRenderer(),this.setup(),this.bindEvents()}return _createClass(i,[{key:"bindEvents",value:function(){window.addEventListener("resize",this.onWindowResize.bind(this))}},{key:"setup",value:function(){this.createParticles=new CreateParticles(this.scene,this.font,this.particle,this.camera,this.renderer)}},{key:"render",value:function(){this.createParticles.render(),this.renderer.render(this.scene,this.camera)}},{key:"createCamera",value:function(){this.camera=new THREE.PerspectiveCamera(65,this.container.clientWidth/this.container.clientHeight,1,1e4),this.camera.position.set(0,70,100)}},{key:"createRenderer",value:function(){var e=this;this.renderer=new THREE.WebGLRenderer,this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.outputEncoding=THREE.sRGBEncoding,this.container.appendChild(this.renderer.domElement),this.renderer.setAnimationLoop(function(){e.render()})}},{key:"onWindowResize",value:function(){this.camera.aspect=this.container.clientWidth/this.container.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight)}}]),i}(),CreateParticles=function(){function r(e,t,i,n,a){_classCallCheck(this,r),this.scene=e,this.font=t,this.particleImg=i,this.camera=n,this.renderer=a,this.raycaster=new THREE.Raycaster,this.mouse=new THREE.Vector2(-200,200),this.colorChange=new THREE.Color,this.buttom=!1,this.data={text:"?",amount:1500,particleSize:1,particleColor:16777215,textSize:80,area:250,ease:.05},this.setup(),this.bindEvents()}return _createClass(r,[{key:"setup",value:function(){var e=new THREE.PlaneGeometry(this.visibleWidthAtZDepth(100,this.camera),this.visibleHeightAtZDepth(100,this.camera)),t=new THREE.MeshBasicMaterial({color:65280,transparent:!0});this.planeArea=new THREE.Mesh(e,t),this.planeArea.visible=!1,this.createText()}},{key:"bindEvents",value:function(){document.addEventListener("mousedown",this.onMouseDown.bind(this)),document.addEventListener("mousemove",this.onMouseMove.bind(this)),document.addEventListener("mouseup",this.onMouseUp.bind(this))}},{key:"onMouseDown",value:function(){this.mouse.x=event.clientX/window.innerWidth*2-1,this.mouse.y=2*-(event.clientY/window.innerHeight)+1;var e=new THREE.Vector3(this.mouse.x,this.mouse.y,.5);e.unproject(this.camera);var t=e.sub(this.camera.position).normalize(),e=-this.camera.position.z/t.z;this.currenPosition=this.camera.position.clone().add(t.multiplyScalar(e));this.particles.geometry.attributes.position;this.buttom=!0,this.data.ease=.01}},{key:"onMouseUp",value:function(){this.buttom=!1,this.data.ease=.05}},{key:"onMouseMove",value:function(){this.mouse.x=event.clientX/window.innerWidth*2-1,this.mouse.y=2*-(event.clientY/window.innerHeight)+1}},{key:"render",value:function(e){var t=.001*performance.now()%12/12;Math.sin(2*t*Math.PI);this.raycaster.setFromCamera(this.mouse,this.camera);t=this.raycaster.intersectObject(this.planeArea);if(0<t.length)for(var i=this.particles.geometry.attributes.position,n=this.geometryCopy.attributes.position,a=this.particles.geometry.attributes.customColor,r=this.particles.geometry.attributes.size,s=t[0].point.x,o=t[0].point.y,h=(t[0].point.z,0),c=i.count;h<c;h++){var l=n.getX(h),d=n.getY(h),u=n.getZ(h),p=i.getX(h),m=i.getY(h),g=i.getZ(h);this.colorChange.setHSL(.5,1,1),a.setXYZ(h,this.colorChange.r,this.colorChange.g,this.colorChange.b),a.needsUpdate=!0,r.array[h]=this.data.particleSize,r.needsUpdate=!0;var v,f,E=this.distance(s,o,p,m),y=(f=s-p)*f+(v=o-m)*v,w=-this.data.area/y;this.buttom?(y=Math.atan2(v,f),p-=w*Math.cos(y),m-=w*Math.sin(y),this.colorChange.setHSL(357/360,1,.67),a.setXYZ(h,this.colorChange.r,this.colorChange.g,this.colorChange.b),a.needsUpdate=!0,(l+70<p||p<l-70||d+70<m||m<d-70)&&(this.colorChange.setHex(16734303),a.setXYZ(h,this.colorChange.r,this.colorChange.g,this.colorChange.b),a.needsUpdate=!0)):E<this.data.area&&(h%5==0?(E=Math.atan2(v,f),p-=.03*Math.cos(E),m-=.03*Math.sin(E),this.colorChange.setHSL(357/360,1,.67),a.setXYZ(h,this.colorChange.r,this.colorChange.g,this.colorChange.b),a.needsUpdate=!0,r.array[h]=this.data.particleSize/1.2):(f=Math.atan2(v,f),p+=w*Math.cos(f),m+=w*Math.sin(f),i.setXYZ(h,p,m,g),i.needsUpdate=!0,r.array[h]=1.3*this.data.particleSize),r.needsUpdate=!0,(l+10<p||p<l-10||d+10<m||m<d-10)&&(this.colorChange.setHex(16734303),a.setXYZ(h,this.colorChange.r,this.colorChange.g,this.colorChange.b),a.needsUpdate=!0,r.array[h]=this.data.particleSize/1.8,r.needsUpdate=!0)),p+=(l-p)*this.data.ease,m+=(d-m)*this.data.ease,g+=(u-g)*this.data.ease,i.setXYZ(h,p,m,g),i.needsUpdate=!0}}},{key:"createText",value:function(){var i=this,n=[],e=this.font.generateShapes(this.data.text,this.data.textSize),t=new THREE.ShapeGeometry(e);t.computeBoundingBox();var a=-.5*(t.boundingBox.max.x-t.boundingBox.min.x),r=(t.boundingBox.max.y-t.boundingBox.min.y)/2.85;t.center(),t.boundingBox.max=0,t.boundingBox.min=12,console.log(t);for(var s=[],o=0;o<e.length;o++){var h=e[o];if(h.holes&&0<h.holes.length)for(var c=0;c<h.holes.length;c++){var l=h.holes[c];s.push(l)}}e.push.apply(e,s);for(var d=[],u=[],p=0;p<e.length;p++){var m=e[p],g="Path"==m.type?this.data.amount/2:this.data.amount;m.getSpacedPoints(g).forEach(function(e,t){e=new THREE.Vector3(e.x,e.y,0);n.push(e),d.push(i.colorChange.r,i.colorChange.g,i.colorChange.b),u.push(1)})}t=(new THREE.BufferGeometry).setFromPoints(n);t.translate(a,r,0),t.setAttribute("customColor",new THREE.Float32BufferAttribute(d,3)),t.setAttribute("size",new THREE.Float32BufferAttribute(u,1));r=new THREE.ShaderMaterial({uniforms:{color:{value:new THREE.Color(16777215)},pointTexture:{value:this.particleImg}},vertexShader:document.getElementById("vertexshader").textContent,fragmentShader:document.getElementById("fragmentshader").textContent,blending:THREE.AdditiveBlending,depthTest:!1,transparent:!0});this.particles=new THREE.Points(t,r),this.scene.add(this.particles),this.scene.background=new THREE.Color(2825782),this.geometryCopy=new THREE.BufferGeometry,this.geometryCopy.copy(this.particles.geometry)}},{key:"visibleHeightAtZDepth",value:function(e,t){var i=t.position.z;e<i?e-=i:e+=i;t=t.fov*Math.PI/180;return 2*Math.tan(t/2)*Math.abs(e)}},{key:"visibleWidthAtZDepth",value:function(e,t){return this.visibleHeightAtZDepth(e,t)*t.aspect}},{key:"distance",value:function(e,t,i,n){return Math.sqrt(Math.pow(e-i,2)+Math.pow(t-n,2))}}]),r}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbW1vbi5qcyJdLCJuYW1lcyI6WyJmYW5jeVN3aXBlciIsIlN3aXBlciIsImRpcmVjdGlvbiIsImxvb3AiLCJzcGVlZCIsInNwYWNlQmV0d2VlbiIsImVmZmVjdCIsImZhZGVFZmZlY3QiLCJjcm9zc0ZhZGUiLCJzbGlkZXNQZXJWaWV3IiwicGFnaW5hdGlvbiIsImVsIiwiY2xpY2thYmxlIiwiY2FmZVN3aXBlciIsIm5hdmlnYXRpb24iLCJuZXh0RWwiLCJwcmV2RWwiLCJmYXFCbG9ja3MiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiYmxvY2siLCJhZGRFdmVudExpc3RlbmVyIiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJyZW1vdmUiLCJhZGQiLCJBT1MiLCJpbml0IiwicHJlbG9hZCIsIm1hbmFnZXIiLCJUSFJFRSIsIkxvYWRpbmdNYW5hZ2VyIiwib25Mb2FkIiwiRW52aXJvbm1lbnQiLCJ0eXBvIiwicGFydGljbGUiLCJGb250TG9hZGVyIiwibG9hZCIsImZvbnQiLCJUZXh0dXJlTG9hZGVyIiwicmVhZHlTdGF0ZSIsImRvY3VtZW50RWxlbWVudCIsImRvU2Nyb2xsIiwiX2NsYXNzQ2FsbENoZWNrIiwidGhpcyIsImNvbnRhaW5lciIsInF1ZXJ5U2VsZWN0b3IiLCJzY2VuZSIsIlNjZW5lIiwiY3JlYXRlQ2FtZXJhIiwiY3JlYXRlUmVuZGVyZXIiLCJzZXR1cCIsImJpbmRFdmVudHMiLCJ3aW5kb3ciLCJvbldpbmRvd1Jlc2l6ZSIsImJpbmQiLCJjcmVhdGVQYXJ0aWNsZXMiLCJDcmVhdGVQYXJ0aWNsZXMiLCJjYW1lcmEiLCJyZW5kZXJlciIsInJlbmRlciIsIlBlcnNwZWN0aXZlQ2FtZXJhIiwiY2xpZW50V2lkdGgiLCJjbGllbnRIZWlnaHQiLCJwb3NpdGlvbiIsInNldCIsIl90aGlzIiwiV2ViR0xSZW5kZXJlciIsInNldFNpemUiLCJzZXRQaXhlbFJhdGlvIiwiTWF0aCIsIm1pbiIsImRldmljZVBpeGVsUmF0aW8iLCJvdXRwdXRFbmNvZGluZyIsInNSR0JFbmNvZGluZyIsImFwcGVuZENoaWxkIiwiZG9tRWxlbWVudCIsInNldEFuaW1hdGlvbkxvb3AiLCJhc3BlY3QiLCJ1cGRhdGVQcm9qZWN0aW9uTWF0cml4IiwicGFydGljbGVJbWciLCJyYXljYXN0ZXIiLCJSYXljYXN0ZXIiLCJtb3VzZSIsIlZlY3RvcjIiLCJjb2xvckNoYW5nZSIsIkNvbG9yIiwiYnV0dG9tIiwiZGF0YSIsInRleHQiLCJhbW91bnQiLCJwYXJ0aWNsZVNpemUiLCJwYXJ0aWNsZUNvbG9yIiwidGV4dFNpemUiLCJhcmVhIiwiZWFzZSIsImdlb21ldHJ5IiwiUGxhbmVHZW9tZXRyeSIsInZpc2libGVXaWR0aEF0WkRlcHRoIiwidmlzaWJsZUhlaWdodEF0WkRlcHRoIiwibWF0ZXJpYWwiLCJNZXNoQmFzaWNNYXRlcmlhbCIsImNvbG9yIiwidHJhbnNwYXJlbnQiLCJwbGFuZUFyZWEiLCJNZXNoIiwidmlzaWJsZSIsImNyZWF0ZVRleHQiLCJvbk1vdXNlRG93biIsIm9uTW91c2VNb3ZlIiwib25Nb3VzZVVwIiwieCIsImV2ZW50IiwiY2xpZW50WCIsImlubmVyV2lkdGgiLCJ5IiwiY2xpZW50WSIsImlubmVySGVpZ2h0IiwidmVjdG9yIiwiVmVjdG9yMyIsInVucHJvamVjdCIsImRpciIsInN1YiIsIm5vcm1hbGl6ZSIsImRpc3RhbmNlIiwieiIsImN1cnJlblBvc2l0aW9uIiwiY2xvbmUiLCJtdWx0aXBseVNjYWxhciIsInBhcnRpY2xlcyIsImF0dHJpYnV0ZXMiLCJsZXZlbCIsInRpbWUiLCJwZXJmb3JtYW5jZSIsIm5vdyIsInNpbiIsIlBJIiwic2V0RnJvbUNhbWVyYSIsImludGVyc2VjdHMiLCJpbnRlcnNlY3RPYmplY3QiLCJsZW5ndGgiLCJwb3MiLCJjb3B5IiwiZ2VvbWV0cnlDb3B5IiwiY291bG9ycyIsImN1c3RvbUNvbG9yIiwic2l6ZSIsIm14IiwicG9pbnQiLCJteSIsImkiLCJsIiwiY291bnQiLCJpbml0WCIsImdldFgiLCJpbml0WSIsImdldFkiLCJpbml0WiIsImdldFoiLCJweCIsInB5IiwicHoiLCJzZXRIU0wiLCJzZXRYWVoiLCJyIiwiZyIsImIiLCJuZWVkc1VwZGF0ZSIsImFycmF5IiwiZHkiLCJ0IiwibW91c2VEaXN0YW5jZSIsImQiLCJkeCIsImYiLCJhdGFuMiIsImNvcyIsInNldEhleCIsIl90aGlzMiIsInRoZVBvaW50cyIsInNoYXBlcyIsImdlbmVyYXRlU2hhcGVzIiwiU2hhcGVHZW9tZXRyeSIsImNvbXB1dGVCb3VuZGluZ0JveCIsInhNaWQiLCJib3VuZGluZ0JveCIsIm1heCIsInlNaWQiLCJjZW50ZXIiLCJjb25zb2xlIiwibG9nIiwiaG9sZVNoYXBlcyIsInEiLCJzaGFwZSIsImhvbGVzIiwiaiIsImhvbGUiLCJwdXNoIiwiYXBwbHkiLCJjb2xvcnMiLCJzaXplcyIsImFtb3VudFBvaW50cyIsInR5cGUiLCJnZXRTcGFjZWRQb2ludHMiLCJlbGVtZW50IiwiYSIsImdlb1BhcnRpY2xlcyIsIkJ1ZmZlckdlb21ldHJ5Iiwic2V0RnJvbVBvaW50cyIsInRyYW5zbGF0ZSIsInNldEF0dHJpYnV0ZSIsIkZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUiLCJTaGFkZXJNYXRlcmlhbCIsInVuaWZvcm1zIiwidmFsdWUiLCJwb2ludFRleHR1cmUiLCJ2ZXJ0ZXhTaGFkZXIiLCJnZXRFbGVtZW50QnlJZCIsInRleHRDb250ZW50IiwiZnJhZ21lbnRTaGFkZXIiLCJibGVuZGluZyIsIkFkZGl0aXZlQmxlbmRpbmciLCJkZXB0aFRlc3QiLCJQb2ludHMiLCJiYWNrZ3JvdW5kIiwiZGVwdGgiLCJjYW1lcmFPZmZzZXQiLCJ2Rk9WIiwiZm92IiwidGFuIiwiYWJzIiwieDEiLCJ5MSIsIngyIiwieTIiLCJzcXJ0IiwicG93Il0sIm1hcHBpbmdzIjoic2NBQUEsSUFBQUEsWUFBQSxJQUFBQyxPQUFBLGlCQUFBLENBQ0FDLFVBQUEsYUFDQUMsTUFBQSxFQUNBQyxNQUFBLElBQ0FDLGFBQUEsR0FDQUMsT0FBQSxPQUNBQyxX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LEVBQUF6SyxFQUFBMEssSUFBQTlKLEtBQUFrRSxHQUFBLElBRUEsT0FBQSxFQUFBbEUsS0FBQStKLElBQUFGLEVBQUEsR0FBQTdKLEtBQUFnSyxJQUFBTCxLLGtDQUdBLFNBQUFBLEVBQUF2SyxHQUVBLE9BREFkLEtBQUF1RCxzQkFBQThILEVBQUF2SyxHQUNBQSxFQUFBb0IsUyxzQkFHQSxTQUFBeUosRUFBQUMsRUFBQUMsRUFBQUMsR0FDQSxPQUFBcEssS0FBQXFLLEtBQUFySyxLQUFBc0ssSUFBQUwsRUFBQUUsRUFBQSxHQUFBbkssS0FBQXNLLElBQUFKLEVBQUFFLEVBQUEsVSIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZmFuY3lTd2lwZXIgPSBuZXcgU3dpcGVyKCcjcHJvY2Vzc1N3aXBlcicsIHtcbiAgICBkaXJlY3Rpb246ICdob3Jpem9udGFsJyxcbiAgICBsb29wOiB0cnVlLFxuICAgIHNwZWVkOiA1MDAsXG4gICAgc3BhY2VCZXR3ZWVuOiAzNCxcbiAgICBlZmZlY3Q6ICdmYWRlJyxcbiAgICBmYWRlRWZmZWN0OiB7XG4gICAgICAgIGNyb3NzRmFkZTogdHJ1ZVxuICAgIH0sXG4gICAgc2xpZGVzUGVyVmlldzogJzEnLFxuICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgZWw6ICcucHJvY2Vzcy1wYXJlbnRfX25hdmlnYXRpb24nLFxuICAgICAgICBjbGlja2FibGU6IHRydWUsXG4gICAgfVxufSk7XG5jb25zdCBjYWZlU3dpcGVyID0gbmV3IFN3aXBlcignI3Jlc3VsdFNlaXBlcicsIHtcbiAgICAvLyBPcHRpb25hbCBwYXJhbWV0ZXJzXG4gICAgZGlyZWN0aW9uOiAnaG9yaXpvbnRhbCcsXG4gICAgbG9vcDogZmFsc2UsXG4gICAgc3BlZWQ6IDQwMCxcbiAgICBlZmZlY3Q6ICdjYXJkcycsXG4gICAgc2xpZGVzUGVyVmlldzogJzEnLFxuXG4gICAgLy8gTmF2aWdhdGlvbiBhcnJvd3NcbiAgICBuYXZpZ2F0aW9uOiB7XG4gICAgICAgIG5leHRFbDogJy5zd2lwZXItYnV0dG9uLW5leHQnLFxuICAgICAgICBwcmV2RWw6ICcuc3dpcGVyLWJ1dHRvbi1wcmV2JyxcbiAgICB9LFxufSk7XG5cbmNvbnN0IGZhcUJsb2NrcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5mYXEtcGFyZW50X19ibG9jaycpO1xuZmFxQmxvY2tzLmZvckVhY2goYmxvY2sgPT4ge1xuICAgIGJsb2NrLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICBpZiAoIWJsb2NrLmNsYXNzTGlzdC5jb250YWlucygnZmFxLXBhcmVudF9fYmxvY2stLWFjdGl2ZScpKSB7XG4gICAgICAgICAgICBibG9jay5jbGFzc0xpc3QuYWRkKCdmYXEtcGFyZW50X19ibG9jay0tYWN0aXZlJylcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2ZhcS1wYXJlbnRfX2Jsb2NrLS1hY3RpdmUnKVxuICAgICAgICB9XG4gICAgfSlcblxufSlcbkFPUy5pbml0KCk7XG5cblxuY29uc3QgcHJlbG9hZCA9ICgpID0+IHtcbiAgICBsZXQgbWFuYWdlciA9IG5ldyBUSFJFRS5Mb2FkaW5nTWFuYWdlcigpO1xuICAgIG1hbmFnZXIub25Mb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBlbnZpcm9ubWVudCA9IG5ldyBFbnZpcm9ubWVudCh0eXBvLCBwYXJ0aWNsZSk7XG4gICAgfVxuICAgIHZhciB0eXBvID0gbnVsbDtcbiAgICBjb25zdCBsb2FkZXIgPSBuZXcgVEhSRUUuRm9udExvYWRlcihtYW5hZ2VyKTtcbiAgICBjb25zdCBmb250ID0gbG9hZGVyLmxvYWQoJ2h0dHBzOi8vcmVzLmNsb3VkaW5hcnkuY29tL2R5ZHJlN2Ftci9yYXcvdXBsb2FkL3YxNjEyOTUwMzU1L2ZvbnRfenNkNGRyLmpzb24nLCBmdW5jdGlvbiAoZm9udCkgeyB0eXBvID0gZm9udDsgfSk7XG4gICAgY29uc3QgcGFydGljbGUgPSBuZXcgVEhSRUUuVGV4dHVyZUxvYWRlcihtYW5hZ2VyKS5sb2FkKCdodHRwczovL3Jlcy5jbG91ZGluYXJ5LmNvbS9kZnZ0a29ib3ovaW1hZ2UvdXBsb2FkL3YxNjA1MDEzODY2L3BhcnRpY2xlX2E2NHV6Zi5wbmcnKTtcbn1cblxuaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScgfHwgKGRvY3VtZW50LnJlYWR5U3RhdGUgIT09ICdsb2FkaW5nJyAmJiAhZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsKSlcbiAgICBwcmVsb2FkKCk7XG5lbHNlXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIHByZWxvYWQpO1xuXG5jbGFzcyBFbnZpcm9ubWVudCB7XG4gICAgY29uc3RydWN0b3IoZm9udCwgcGFydGljbGUpIHtcbiAgICAgICAgdGhpcy5mb250ID0gZm9udDtcbiAgICAgICAgdGhpcy5wYXJ0aWNsZSA9IHBhcnRpY2xlO1xuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtYWdpYycpO1xuICAgICAgICB0aGlzLnNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7XG4gICAgICAgIHRoaXMuY3JlYXRlQ2FtZXJhKCk7XG4gICAgICAgIHRoaXMuY3JlYXRlUmVuZGVyZXIoKTtcbiAgICAgICAgdGhpcy5zZXR1cCgpXG4gICAgICAgIHRoaXMuYmluZEV2ZW50cygpO1xuICAgIH1cblxuICAgIGJpbmRFdmVudHMoKSB7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uV2luZG93UmVzaXplLmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIHNldHVwKCkge1xuICAgICAgICB0aGlzLmNyZWF0ZVBhcnRpY2xlcyA9IG5ldyBDcmVhdGVQYXJ0aWNsZXModGhpcy5zY2VuZSwgdGhpcy5mb250LCB0aGlzLnBhcnRpY2xlLCB0aGlzLmNhbWVyYSwgdGhpcy5yZW5kZXJlcik7XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICB0aGlzLmNyZWF0ZVBhcnRpY2xlcy5yZW5kZXIoKVxuICAgICAgICB0aGlzLnJlbmRlcmVyLnJlbmRlcih0aGlzLnNjZW5lLCB0aGlzLmNhbWVyYSlcbiAgICB9XG5cbiAgICBjcmVhdGVDYW1lcmEoKSB7XG4gICAgICAgIHRoaXMuY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKDY1LCB0aGlzLmNvbnRhaW5lci5jbGllbnRXaWR0aCAvIHRoaXMuY29udGFpbmVyLmNsaWVudEhlaWdodCwgMSwgMTAwMDApO1xuICAgICAgICB0aGlzLmNhbWVyYS5wb3NpdGlvbi5zZXQoMCwgNzAsIDEwMCk7XG4gICAgfVxuXG4gICAgY3JlYXRlUmVuZGVyZXIoKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcigpO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFNpemUodGhpcy5jb250YWluZXIuY2xpZW50V2lkdGgsIHRoaXMuY29udGFpbmVyLmNsaWVudEhlaWdodCk7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyhNYXRoLm1pbih3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbywgMikpO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLm91dHB1dEVuY29kaW5nID0gVEhSRUUuc1JHQkVuY29kaW5nO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLnJlbmRlcmVyLmRvbUVsZW1lbnQpO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldEFuaW1hdGlvbkxvb3AoKCkgPT4geyB0aGlzLnJlbmRlcigpIH0pXG4gICAgfVxuXG4gICAgb25XaW5kb3dSZXNpemUoKSB7XG4gICAgICAgIHRoaXMuY2FtZXJhLmFzcGVjdCA9IHRoaXMuY29udGFpbmVyLmNsaWVudFdpZHRoIC8gdGhpcy5jb250YWluZXIuY2xpZW50SGVpZ2h0O1xuICAgICAgICB0aGlzLmNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U2l6ZSh0aGlzLmNvbnRhaW5lci5jbGllbnRXaWR0aCwgdGhpcy5jb250YWluZXIuY2xpZW50SGVpZ2h0KTtcbiAgICB9XG59XG5cbmNsYXNzIENyZWF0ZVBhcnRpY2xlcyB7XG4gICAgY29uc3RydWN0b3Ioc2NlbmUsIGZvbnQsIHBhcnRpY2xlSW1nLCBjYW1lcmEsIHJlbmRlcmVyKSB7XG4gICAgICAgIHRoaXMuc2NlbmUgPSBzY2VuZTtcbiAgICAgICAgdGhpcy5mb250ID0gZm9udDtcbiAgICAgICAgdGhpcy5wYXJ0aWNsZUltZyA9IHBhcnRpY2xlSW1nO1xuICAgICAgICB0aGlzLmNhbWVyYSA9IGNhbWVyYTtcbiAgICAgICAgdGhpcy5yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgICAgICB0aGlzLnJheWNhc3RlciA9IG5ldyBUSFJFRS5SYXljYXN0ZXIoKTtcbiAgICAgICAgdGhpcy5tb3VzZSA9IG5ldyBUSFJFRS5WZWN0b3IyKC0yMDAsIDIwMCk7XG4gICAgICAgIHRoaXMuY29sb3JDaGFuZ2UgPSBuZXcgVEhSRUUuQ29sb3IoKTtcbiAgICAgICAgdGhpcy5idXR0b20gPSBmYWxzZTtcblxuICAgICAgICB0aGlzLmRhdGEgPSB7XG4gICAgICAgICAgICB0ZXh0OiAnPycsXG4gICAgICAgICAgICBhbW91bnQ6IDE1MDAsXG4gICAgICAgICAgICBwYXJ0aWNsZVNpemU6IDEsXG4gICAgICAgICAgICBwYXJ0aWNsZUNvbG9yOiAweGZmZmZmZixcbiAgICAgICAgICAgIHRleHRTaXplOiA4MCxcbiAgICAgICAgICAgIGFyZWE6IDI1MCxcbiAgICAgICAgICAgIGVhc2U6IC4wNSxcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2V0dXAoKTtcbiAgICAgICAgdGhpcy5iaW5kRXZlbnRzKCk7XG4gICAgfVxuXG4gICAgc2V0dXAoKSB7XG4gICAgICAgIGNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkodGhpcy52aXNpYmxlV2lkdGhBdFpEZXB0aCgxMDAsIHRoaXMuY2FtZXJhKSwgdGhpcy52aXNpYmxlSGVpZ2h0QXRaRGVwdGgoMTAwLCB0aGlzLmNhbWVyYSkpO1xuICAgICAgICBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweDAwZmYwMCwgdHJhbnNwYXJlbnQ6IHRydWUgfSk7XG4gICAgICAgIHRoaXMucGxhbmVBcmVhID0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIG1hdGVyaWFsKTtcbiAgICAgICAgdGhpcy5wbGFuZUFyZWEudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNyZWF0ZVRleHQoKTtcbiAgICB9XG5cbiAgICBiaW5kRXZlbnRzKCkge1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLm9uTW91c2VEb3duLmJpbmQodGhpcykpO1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLm9uTW91c2VNb3ZlLmJpbmQodGhpcykpO1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5vbk1vdXNlVXAuYmluZCh0aGlzKSk7XG4gICAgfVxuXG4gICAgb25Nb3VzZURvd24oKSB7XG4gICAgICAgIHRoaXMubW91c2UueCA9IChldmVudC5jbGllbnRYIC8gd2luZG93LmlubmVyV2lkdGgpICogMiAtIDE7XG4gICAgICAgIHRoaXMubW91c2UueSA9IC0gKGV2ZW50LmNsaWVudFkgLyB3aW5kb3cuaW5uZXJIZWlnaHQpICogMiArIDE7XG5cbiAgICAgICAgY29uc3QgdmVjdG9yID0gbmV3IFRIUkVFLlZlY3RvcjModGhpcy5tb3VzZS54LCB0aGlzLm1vdXNlLnksIDAuNSk7XG4gICAgICAgIHZlY3Rvci51bnByb2plY3QodGhpcy5jYW1lcmEpO1xuICAgICAgICBjb25zdCBkaXIgPSB2ZWN0b3Iuc3ViKHRoaXMuY2FtZXJhLnBvc2l0aW9uKS5ub3JtYWxpemUoKTtcbiAgICAgICAgY29uc3QgZGlzdGFuY2UgPSAtIHRoaXMuY2FtZXJhLnBvc2l0aW9uLnogLyBkaXIuejtcbiAgICAgICAgdGhpcy5jdXJyZW5Qb3NpdGlvbiA9IHRoaXMuY2FtZXJhLnBvc2l0aW9uLmNsb25lKCkuYWRkKGRpci5tdWx0aXBseVNjYWxhcihkaXN0YW5jZSkpO1xuXG4gICAgICAgIGNvbnN0IHBvcyA9IHRoaXMucGFydGljbGVzLmdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb247XG4gICAgICAgIHRoaXMuYnV0dG9tID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5kYXRhLmVhc2UgPSAuMDE7XG4gICAgfVxuXG4gICAgb25Nb3VzZVVwKCkge1xuICAgICAgICB0aGlzLmJ1dHRvbSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmRhdGEuZWFzZSA9IC4wNTtcbiAgICB9XG5cbiAgICBvbk1vdXNlTW92ZSgpIHtcbiAgICAgICAgdGhpcy5tb3VzZS54ID0gKGV2ZW50LmNsaWVudFggLyB3aW5kb3cuaW5uZXJXaWR0aCkgKiAyIC0gMTtcbiAgICAgICAgdGhpcy5tb3VzZS55ID0gLSAoZXZlbnQuY2xpZW50WSAvIHdpbmRvdy5pbm5lckhlaWdodCkgKiAyICsgMTtcbiAgICB9XG5cbiAgICByZW5kZXIobGV2ZWwpIHtcbiAgICAgICAgY29uc3QgdGltZSA9ICgoLjAwMSAqIHBlcmZvcm1hbmNlLm5vdygpKSAlIDEyKSAvIDEyO1xuICAgICAgICBjb25zdCB6aWd6YWdUaW1lID0gKDEgKyAoTWF0aC5zaW4odGltZSAqIDIgKiBNYXRoLlBJKSkpIC8gNjtcblxuICAgICAgICB0aGlzLnJheWNhc3Rlci5zZXRGcm9tQ2FtZXJhKHRoaXMubW91c2UsIHRoaXMuY2FtZXJhKTtcblxuICAgICAgICBjb25zdCBpbnRlcnNlY3RzID0gdGhpcy5yYXljYXN0ZXIuaW50ZXJzZWN0T2JqZWN0KHRoaXMucGxhbmVBcmVhKTtcblxuICAgICAgICBpZiAoaW50ZXJzZWN0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBwb3MgPSB0aGlzLnBhcnRpY2xlcy5nZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uO1xuICAgICAgICAgICAgY29uc3QgY29weSA9IHRoaXMuZ2VvbWV0cnlDb3B5LmF0dHJpYnV0ZXMucG9zaXRpb247XG4gICAgICAgICAgICBjb25zdCBjb3Vsb3JzID0gdGhpcy5wYXJ0aWNsZXMuZ2VvbWV0cnkuYXR0cmlidXRlcy5jdXN0b21Db2xvcjtcbiAgICAgICAgICAgIGNvbnN0IHNpemUgPSB0aGlzLnBhcnRpY2xlcy5nZW9tZXRyeS5hdHRyaWJ1dGVzLnNpemU7XG4gICAgICAgICAgICBjb25zdCBteCA9IGludGVyc2VjdHNbMF0ucG9pbnQueDtcbiAgICAgICAgICAgIGNvbnN0IG15ID0gaW50ZXJzZWN0c1swXS5wb2ludC55O1xuICAgICAgICAgICAgY29uc3QgbXogPSBpbnRlcnNlY3RzWzBdLnBvaW50Lno7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gcG9zLmNvdW50OyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5pdFggPSBjb3B5LmdldFgoaSk7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5pdFkgPSBjb3B5LmdldFkoaSk7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5pdFogPSBjb3B5LmdldFooaSk7XG5cbiAgICAgICAgICAgICAgICBsZXQgcHggPSBwb3MuZ2V0WChpKTtcbiAgICAgICAgICAgICAgICBsZXQgcHkgPSBwb3MuZ2V0WShpKTtcbiAgICAgICAgICAgICAgICBsZXQgcHogPSBwb3MuZ2V0WihpKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuY29sb3JDaGFuZ2Uuc2V0SFNMKC41LCAxLCAxKVxuICAgICAgICAgICAgICAgIGNvdWxvcnMuc2V0WFlaKGksIHRoaXMuY29sb3JDaGFuZ2UuciwgdGhpcy5jb2xvckNoYW5nZS5nLCB0aGlzLmNvbG9yQ2hhbmdlLmIpXG4gICAgICAgICAgICAgICAgY291bG9ycy5uZWVkc1VwZGF0ZSA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICBzaXplLmFycmF5W2ldID0gdGhpcy5kYXRhLnBhcnRpY2xlU2l6ZTtcbiAgICAgICAgICAgICAgICBzaXplLm5lZWRzVXBkYXRlID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIGxldCBkeCA9IG14IC0gcHg7XG4gICAgICAgICAgICAgICAgbGV0IGR5ID0gbXkgLSBweTtcbiAgICAgICAgICAgICAgICBjb25zdCBkeiA9IG16IC0gcHo7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBtb3VzZURpc3RhbmNlID0gdGhpcy5kaXN0YW5jZShteCwgbXksIHB4LCBweSlcbiAgICAgICAgICAgICAgICBsZXQgZCA9IChkeCA9IG14IC0gcHgpICogZHggKyAoZHkgPSBteSAtIHB5KSAqIGR5O1xuICAgICAgICAgICAgICAgIGNvbnN0IGYgPSAtIHRoaXMuZGF0YS5hcmVhIC8gZDtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmJ1dHRvbSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gTWF0aC5hdGFuMihkeSwgZHgpO1xuICAgICAgICAgICAgICAgICAgICBweCAtPSBmICogTWF0aC5jb3ModCk7XG4gICAgICAgICAgICAgICAgICAgIHB5IC09IGYgKiBNYXRoLnNpbih0KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmNvbG9yQ2hhbmdlLnNldEhTTCggLjUgKyB6aWd6YWdUaW1lLCAxLjAgLCAuNSApXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29sb3JDaGFuZ2Uuc2V0SFNMKDM1NyAvIDM2MCwgMS4wLCAuNjcpIC8vIHBhcnRpY2xlcyBpbiBjZW50ZXIgY29sb3JcbiAgICAgICAgICAgICAgICAgICAgY291bG9ycy5zZXRYWVooaSwgdGhpcy5jb2xvckNoYW5nZS5yLCB0aGlzLmNvbG9yQ2hhbmdlLmcsIHRoaXMuY29sb3JDaGFuZ2UuYilcbiAgICAgICAgICAgICAgICAgICAgY291bG9ycy5uZWVkc1VwZGF0ZSA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKChweCA+IChpbml0WCArIDcwKSkgfHwgKHB4IDwgKGluaXRYIC0gNzApKSB8fCAocHkgPiAoaW5pdFkgKyA3MCkgfHwgKHB5IDwgKGluaXRZIC0gNzApKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuY29sb3JDaGFuZ2Uuc2V0SFNMKCAuMTUsIDEuMCAsIC41IClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sb3JDaGFuZ2Uuc2V0SGV4KDB4RkY1ODVGKSAvLyBwYXJ0aWNsZXMgbW91c2Vkb3duIGNvbG9yXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3Vsb3JzLnNldFhZWihpLCB0aGlzLmNvbG9yQ2hhbmdlLnIsIHRoaXMuY29sb3JDaGFuZ2UuZywgdGhpcy5jb2xvckNoYW5nZS5iKVxuICAgICAgICAgICAgICAgICAgICAgICAgY291bG9ycy5uZWVkc1VwZGF0ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAobW91c2VEaXN0YW5jZSA8IHRoaXMuZGF0YS5hcmVhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSAlIDUgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBNYXRoLmF0YW4yKGR5LCBkeCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHggLT0gLjAzICogTWF0aC5jb3ModCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHkgLT0gLjAzICogTWF0aC5zaW4odCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmNvbG9yQ2hhbmdlLnNldEhTTCggLjE1ICwgMS4wICwgLjUgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sb3JDaGFuZ2Uuc2V0SFNMKDM1NyAvIDM2MCwgMS4wLCAuNjcpIC8vIGNvbG9yIHRleHQgYmFja1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdWxvcnMuc2V0WFlaKGksIHRoaXMuY29sb3JDaGFuZ2UuciwgdGhpcy5jb2xvckNoYW5nZS5nLCB0aGlzLmNvbG9yQ2hhbmdlLmIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bG9ycy5uZWVkc1VwZGF0ZSA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplLmFycmF5W2ldID0gdGhpcy5kYXRhLnBhcnRpY2xlU2l6ZSAvIDEuMjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplLm5lZWRzVXBkYXRlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBNYXRoLmF0YW4yKGR5LCBkeCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHggKz0gZiAqIE1hdGguY29zKHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB5ICs9IGYgKiBNYXRoLnNpbih0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3Muc2V0WFlaKGksIHB4LCBweSwgcHopO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcy5uZWVkc1VwZGF0ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZS5hcnJheVtpXSA9IHRoaXMuZGF0YS5wYXJ0aWNsZVNpemUgKiAxLjM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZS5uZWVkc1VwZGF0ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgocHggPiAoaW5pdFggKyAxMCkpIHx8IChweCA8IChpbml0WCAtIDEwKSkgfHwgKHB5ID4gKGluaXRZICsgMTApIHx8IChweSA8IChpbml0WSAtIDEwKSkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5jb2xvckNoYW5nZS5zZXRIU0woIC4xNSwgMS4wICwgLjUgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sb3JDaGFuZ2Uuc2V0SGV4KDB4RkY1ODVGKSAvLyBob3ZlciBsaW5lIGVmZmVjdFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdWxvcnMuc2V0WFlaKGksIHRoaXMuY29sb3JDaGFuZ2UuciwgdGhpcy5jb2xvckNoYW5nZS5nLCB0aGlzLmNvbG9yQ2hhbmdlLmIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bG9ycy5uZWVkc1VwZGF0ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZS5hcnJheVtpXSA9IHRoaXMuZGF0YS5wYXJ0aWNsZVNpemUgLyAxLjg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZS5uZWVkc1VwZGF0ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBweCArPSAoaW5pdFggLSBweCkgKiB0aGlzLmRhdGEuZWFzZTtcbiAgICAgICAgICAgICAgICBweSArPSAoaW5pdFkgLSBweSkgKiB0aGlzLmRhdGEuZWFzZTtcbiAgICAgICAgICAgICAgICBweiArPSAoaW5pdFogLSBweikgKiB0aGlzLmRhdGEuZWFzZTtcbiAgICAgICAgICAgICAgICBwb3Muc2V0WFlaKGksIHB4LCBweSwgcHopO1xuICAgICAgICAgICAgICAgIHBvcy5uZWVkc1VwZGF0ZSA9IHRydWU7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNyZWF0ZVRleHQoKSB7XG4gICAgICAgIGxldCB0aGVQb2ludHMgPSBbXTtcbiAgICAgICAgbGV0IHNoYXBlcyA9IHRoaXMuZm9udC5nZW5lcmF0ZVNoYXBlcyh0aGlzLmRhdGEudGV4dCwgdGhpcy5kYXRhLnRleHRTaXplKTtcbiAgICAgICAgbGV0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLlNoYXBlR2VvbWV0cnkoc2hhcGVzKTtcbiAgICAgICAgZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nQm94KCk7XG5cbiAgICAgICAgY29uc3QgeE1pZCA9IC0gMC41ICogKGdlb21ldHJ5LmJvdW5kaW5nQm94Lm1heC54IC0gZ2VvbWV0cnkuYm91bmRpbmdCb3gubWluLngpO1xuICAgICAgICBjb25zdCB5TWlkID0gKGdlb21ldHJ5LmJvdW5kaW5nQm94Lm1heC55IC0gZ2VvbWV0cnkuYm91bmRpbmdCb3gubWluLnkpIC8gMi44NTtcblxuICAgICAgICBnZW9tZXRyeS5jZW50ZXIoKTtcbiAgICAgICAgZ2VvbWV0cnkuYm91bmRpbmdCb3gubWF4ID0gMDtcbiAgICAgICAgZ2VvbWV0cnkuYm91bmRpbmdCb3gubWluID0gMTI7XG4gICAgICAgIGNvbnNvbGUubG9nKGdlb21ldHJ5KTtcblxuICAgICAgICBsZXQgaG9sZVNoYXBlcyA9IFtdO1xuXG4gICAgICAgIGZvciAobGV0IHEgPSAwOyBxIDwgc2hhcGVzLmxlbmd0aDsgcSsrKSB7XG4gICAgICAgICAgICBsZXQgc2hhcGUgPSBzaGFwZXNbcV07XG5cbiAgICAgICAgICAgIGlmIChzaGFwZS5ob2xlcyAmJiBzaGFwZS5ob2xlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZS5ob2xlcy5sZW5ndGg7IGorKykge1xuXG4gICAgICAgICAgICAgICAgICAgIGxldCBob2xlID0gc2hhcGUuaG9sZXNbal07XG4gICAgICAgICAgICAgICAgICAgIGhvbGVTaGFwZXMucHVzaChob2xlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc2hhcGVzLnB1c2guYXBwbHkoc2hhcGVzLCBob2xlU2hhcGVzKTtcblxuICAgICAgICBsZXQgY29sb3JzID0gW107XG4gICAgICAgIGxldCBzaXplcyA9IFtdO1xuXG4gICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgc2hhcGVzLmxlbmd0aDsgeCsrKSB7XG4gICAgICAgICAgICBsZXQgc2hhcGUgPSBzaGFwZXNbeF07XG4gICAgICAgICAgICBjb25zdCBhbW91bnRQb2ludHMgPSAoc2hhcGUudHlwZSA9PSAnUGF0aCcpID8gdGhpcy5kYXRhLmFtb3VudCAvIDIgOiB0aGlzLmRhdGEuYW1vdW50O1xuICAgICAgICAgICAgbGV0IHBvaW50cyA9IHNoYXBlLmdldFNwYWNlZFBvaW50cyhhbW91bnRQb2ludHMpO1xuXG4gICAgICAgICAgICBwb2ludHMuZm9yRWFjaCgoZWxlbWVudCwgeikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBuZXcgVEhSRUUuVmVjdG9yMyhlbGVtZW50LngsIGVsZW1lbnQueSwgMCk7XG4gICAgICAgICAgICAgICAgdGhlUG9pbnRzLnB1c2goYSk7XG4gICAgICAgICAgICAgICAgY29sb3JzLnB1c2godGhpcy5jb2xvckNoYW5nZS5yLCB0aGlzLmNvbG9yQ2hhbmdlLmcsIHRoaXMuY29sb3JDaGFuZ2UuYik7XG4gICAgICAgICAgICAgICAgc2l6ZXMucHVzaCgxKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgZ2VvUGFydGljbGVzID0gbmV3IFRIUkVFLkJ1ZmZlckdlb21ldHJ5KCkuc2V0RnJvbVBvaW50cyh0aGVQb2ludHMpO1xuICAgICAgICBnZW9QYXJ0aWNsZXMudHJhbnNsYXRlKHhNaWQsIHlNaWQsIDApO1xuICAgICAgICBnZW9QYXJ0aWNsZXMuc2V0QXR0cmlidXRlKCdjdXN0b21Db2xvcicsIG5ldyBUSFJFRS5GbG9hdDMyQnVmZmVyQXR0cmlidXRlKGNvbG9ycywgMykpO1xuICAgICAgICBnZW9QYXJ0aWNsZXMuc2V0QXR0cmlidXRlKCdzaXplJywgbmV3IFRIUkVFLkZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoc2l6ZXMsIDEpKTtcblxuICAgICAgICBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5TaGFkZXJNYXRlcmlhbCh7XG4gICAgICAgICAgICB1bmlmb3Jtczoge1xuICAgICAgICAgICAgICAgIGNvbG9yOiB7IHZhbHVlOiBuZXcgVEhSRUUuQ29sb3IoMHhmZmZmZmYpIH0sXG4gICAgICAgICAgICAgICAgcG9pbnRUZXh0dXJlOiB7IHZhbHVlOiB0aGlzLnBhcnRpY2xlSW1nIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB2ZXJ0ZXhTaGFkZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2ZXJ0ZXhzaGFkZXInKS50ZXh0Q29udGVudCxcbiAgICAgICAgICAgIGZyYWdtZW50U2hhZGVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZnJhZ21lbnRzaGFkZXInKS50ZXh0Q29udGVudCxcblxuICAgICAgICAgICAgYmxlbmRpbmc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcsXG4gICAgICAgICAgICBkZXB0aFRlc3Q6IGZhbHNlLFxuICAgICAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMucGFydGljbGVzID0gbmV3IFRIUkVFLlBvaW50cyhnZW9QYXJ0aWNsZXMsIG1hdGVyaWFsKTtcbiAgICAgICAgdGhpcy5zY2VuZS5hZGQodGhpcy5wYXJ0aWNsZXMpO1xuICAgICAgICB0aGlzLnNjZW5lLmJhY2tncm91bmQgPSBuZXcgVEhSRUUuQ29sb3IoMHgyQjFFMzYpOyAvLyBjb2xvciBiZ1xuXG4gICAgICAgIHRoaXMuZ2VvbWV0cnlDb3B5ID0gbmV3IFRIUkVFLkJ1ZmZlckdlb21ldHJ5KCk7XG4gICAgICAgIHRoaXMuZ2VvbWV0cnlDb3B5LmNvcHkodGhpcy5wYXJ0aWNsZXMuZ2VvbWV0cnkpO1xuICAgIH1cblxuICAgIHZpc2libGVIZWlnaHRBdFpEZXB0aChkZXB0aCwgY2FtZXJhKSB7XG4gICAgICAgIGNvbnN0IGNhbWVyYU9mZnNldCA9IGNhbWVyYS5wb3NpdGlvbi56O1xuXG4gICAgICAgIGlmIChkZXB0aCA8IGNhbWVyYU9mZnNldCkgZGVwdGggLT0gY2FtZXJhT2Zmc2V0O1xuICAgICAgICBlbHNlIGRlcHRoICs9IGNhbWVyYU9mZnNldDtcblxuICAgICAgICBjb25zdCB2Rk9WID0gY2FtZXJhLmZvdiAqIE1hdGguUEkgLyAxODA7XG5cbiAgICAgICAgcmV0dXJuIDIgKiBNYXRoLnRhbih2Rk9WIC8gMikgKiBNYXRoLmFicyhkZXB0aCk7XG4gICAgfVxuXG4gICAgdmlzaWJsZVdpZHRoQXRaRGVwdGgoZGVwdGgsIGNhbWVyYSkge1xuICAgICAgICBjb25zdCBoZWlnaHQgPSB0aGlzLnZpc2libGVIZWlnaHRBdFpEZXB0aChkZXB0aCwgY2FtZXJhKTtcbiAgICAgICAgcmV0dXJuIGhlaWdodCAqIGNhbWVyYS5hc3BlY3Q7XG4gICAgfVxuXG4gICAgZGlzdGFuY2UoeDEsIHkxLCB4MiwgeTIpIHtcbiAgICAgICAgcmV0dXJuIE1hdGguc3FydChNYXRoLnBvdygoeDEgLSB4MiksIDIpICsgTWF0aC5wb3coKHkxIC0geTIpLCAyKSk7XG4gICAgfVxufVxuIl19
